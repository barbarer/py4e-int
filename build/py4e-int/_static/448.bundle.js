(self.webpackChunkWebComponents=self.webpackChunkWebComponents||[]).push([[448],{70448:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(74402);async function o(e,t,i){if(!e)return void jQuery(`#${t}`).html("<p>Sorry, no source is available for preview.</p>");e=e.replace(/..\/_images/g,`${eBookConfig.app}/books/published/${eBookConfig.basecourse}/_images`),jQuery(`#${t}`).html(e),void 0===window.edList&&(window.edList={});let o=$($(`#${t} [data-component]`)[0]).data("component");await(0,n.J)(o);let s={};if(s.orig=jQuery(`#${t} [data-component]`)[0],s.orig&&(s.lang=$(s.orig).data("lang"),s.useRunestoneServices=!0,s.graderactive=!1,s.python3=!0,void 0!==i))for(let e in i)s[e]=i[e];if("undefined"==typeof component_factory)alert("Error:  Missing the component factory!");else if(window.component_factory[o]||jQuery(`#${t}`).html()){let e=window.component_factory[o](s);"activecode"===o&&(i.multiGrader?window.edList[`${i.gradingContainer} ${e.divid}`]=e:window.edList[e.divid]=e)}else jQuery(`#${t}`).html(`<p>Preview not available for ${o}</p>`)}var s=i(2568);class a extends s.Z{constructor(e){super(e),this.origOpts=e,this.questions=$(e.orig).data("questionlist"),this.proficiency=$(e.orig).data("proficiency"),this.minDifficulty=$(e.orig).data("minDifficulty"),this.maxDifficulty=$(e.orig).data("maxDifficulty"),this.points=$(e.orig).data("points"),this.autogradable=$(e.orig).data("autogradable"),this.not_seen_ever=$(e.orig).data("not_seen_ever"),this.selector_id=$(e.orig).first().attr("id"),this.primaryOnly=$(e.orig).data("primary"),this.ABExperiment=$(e.orig).data("ab"),this.toggleOptions=$(e.orig).data("toggleoptions"),this.toggleLabels=$(e.orig).data("togglelabels"),e.orig.id=this.selector_id}async initialize(){let e=this,t={selector_id:this.selector_id};this.questions?t.questions=this.questions:this.proficiency&&(t.proficiency=this.proficiency),this.minDifficulty&&(t.minDifficulty=this.minDifficulty),this.maxDifficulty&&(t.maxDifficulty=this.maxDifficulty),this.points&&(t.points=this.points),this.autogradable&&(t.autogradable=this.autogradable),this.not_seen_ever&&(t.not_seen_ever=this.not_seen_ever),this.primaryOnly&&(t.primary=this.primaryOnly),this.ABExperiment&&(t.AB=this.ABExperiment),this.timedWrapper&&(t.timedWrapper=this.timedWrapper),this.toggleOptions&&(t.toggleOptions=this.toggleOptions),this.toggleLabels&&(t.toggleLabels=this.toggleLabels);let i=this.origOpts,n=this.selector_id;console.log("getting question source");let s,a=new Request("/runestone/ajax/get_question_source",{method:"POST",headers:this.jsonHeaders,body:JSON.stringify(t)}),r=await fetch(a),l=await r.json();if(l.indexOf("No preview")>=0)throw alert(`Error: Not able to find a question for ${n} based on the criteria`),new Error(`Unable to find a question for ${n}`);if(i.timed){s=function(e,t){e=e.replace(/..\/_images/g,`${eBookConfig.app}/books/published/${eBookConfig.basecourse}/_images`);let i,n,o=$($(e).find("[data-component]")[0]).data("component"),s=$(e).find("[data-component]").first().attr("id");document.getElementById(s)||(i=$("<div/>",{css:{display:"none"}}).appendTo("body"),i.html(e));let a={orig:document.getElementById(s),timed:!0};if(void 0!==t)for(let e in t)a[e]=t[e];o in window.component_factory&&(n=window.component_factory[o](a));let r={};return r.question=n,r}(l,{timed:!0,selector_id:n,assessmentTaken:i.assessmentTaken});for(let t of i.rqa)if(t.question==e){t.question=s.question;break}e.realComponent=s.question,e.containerDiv=s.question.containerDiv,e.realComponent.selectorId=n}else{if(t.toggleOptions){var c=t.toggleLabels.replace("togglelabels:","").trim();if(c){c=c.split(",");for(var d=0;d<c.length;d++)c[d]=c[d].trim()}var g,p,u,m=this.questions.split(", "),f="";document.getElementById("component-preview")||(f+='<div id="component-preview" class="col-md-6 toggle-preview" style="z-index: 999;"><div id="toggle-buttons"></div><div id="toggle-preview"></div></div>'),f+='<label for="'+n+'-toggleQuestion" style="margin-left: 10px">Toggle Question:</label><select id="'+n+'-toggleQuestion">';var h=[];for(g=0;g<m.length;g++){switch((p=(await this.getToggleSrc(m[g])).split('data-component="')[1]).slice(0,p.indexOf('"'))){case"activecode":u="Active Write Code";break;case"clickablearea":u="Clickable Area";break;case"dragndrop":u="Drag n Drop";break;case"fillintheblank":u="Fill in the Blank";break;case"multiplechoice":u="Multiple Choice";break;case"parsons":u="Parsons Mixed-Up Code";break;case"shortanswer":u="Short Answer"}h[g]=u,f+='<option value="'+m[g]+'">',c&&c[g]?f+=c[g]:f+=u+" - "+m[g],0==g&&t.toggleOptions.includes("lock")&&(f+=" (only this question will be graded)"),f+="</option>"}f+='</select><div id="'+n+'-toggleSelectedQuestion">';var y=l.split('id="')[1];y=y.split('"')[0],l=f+l+"</div>"}if(await o(l,n,{selector_id:n,useRunestoneServices:!0}),t.toggleOptions){$("#component-preview").hide();var v=document.getElementById(n+"-toggleQuestion");for(g=0;g<v.options.length;g++)if(v.options[g].value==y){v.value=y,$("#"+n).data("toggle_current",y),$("#"+n).data("toggle_current_type",h[0]);break}v.addEventListener("change",async function(){await this.togglePreview(v.parentElement.id,t.toggleOptions,h)}.bind(this))}}return r}async getToggleSrc(e){let t=new Request("/runestone/admin/htmlsrc?acid="+e,{method:"GET"}),i=await fetch(t);return await i.json()}async togglePreview(e,t,i){$("#toggle-buttons").html("");var n=document.getElementById(e).getElementsByTagName("select")[0],s=n.options[n.selectedIndex].value,a=await this.getToggleSrc(s);o(a,"toggle-preview",{selector_id:"toggle-preview",useRunestoneServices:!0});let r=document.createElement("button");if($(r).text("Close Preview"),$(r).addClass("btn btn-default"),$(r).click((function(t){$("#toggle-preview").html(""),n.value=$("#"+e).data("toggle_current"),$("#component-preview").hide()})),$("#toggle-buttons").append(r),!t.includes("lock")){let o=document.createElement("button");if($(o).text("Select this Problem"),$(o).addClass("btn btn-primary"),$(o).click(async function(){await this.toggleSet(e,s,a,i),$("#component-preview").hide()}.bind(this)),$("#toggle-buttons").append(o),t.includes("transfer")){var l=$("#"+e).data("toggle_current_type"),c=i[n.selectedIndex];if("Parsons Mixed-Up Code"==l&&"Active Write Code"==c){let t=document.createElement("button");$(t).text("Transfer Response"),$(t).addClass("btn btn-primary"),$(t).click(async function(){await this.toggleTransfer(e,s,a,i)}.bind(this)),$("#toggle-buttons").append(t)}}}$("#component-preview").show()}async toggleSet(e,t,i,n){var s=e+"-toggleSelectedQuestion",a=document.getElementById(e).getElementsByTagName("select")[0];document.getElementById(s).innerHTML="",await o(i,s,{selector_id:s,useRunestoneServices:!0});let r=new Request("/runestone/ajax/update_selected_question?metaid="+e+"&selected="+t,{});await fetch(r),$("#toggle-preview").html(""),$("#"+e).data("toggle_current",t),$("#"+e).data("toggle_current_type",n[a.selectedIndex])}async toggleTransfer(e,t,i,n){for(var o,s,a,r,l,c,d=document.getElementById(e+"-toggleSelectedQuestion").querySelectorAll("div[class^='answer']")[0].getElementsByClassName("prettyprint lang-py"),g="",p=0;p<d.length;p++){a=0,r="",(o=d[p].classList[2])&&o.includes("indent")&&(a=parseInt(a)+parseInt(o.slice(6,o.length))),(s=d[p].parentElement.parentElement.style.left)&&(a=parseInt(a)+parseInt(s.slice(0,s.indexOf("px"))/30));for(var u=0;u<a;u++)r+="    ";l=d[p].getElementsByTagName("span"),c=0;for(var m=0;m<l.length;m++)"#text"==l[m].childNodes[0].nodeName&&(0==p&&0==c?(g+=r+l[m].innerHTML,c++):0!=c?(g+=l[m].innerHTML,c++):(g=(g=g+"\n                            "+r+l[m].innerHTML).replace("                            ",""),c++))}var f=i.slice(0,i.indexOf("<textarea")+i.split("<textarea")[1].indexOf(">")+10),h=i.slice(i.indexOf("</textarea>"),i.length);i=f+g+h,await this.toggleSet(e,t,i,n),$("#component-preview").hide()}}void 0===window.component_factory&&(window.component_factory={}),window.component_factory.selectquestion=function(e){return new a(e)},$(document).bind("runestone:login-complete",(async function(){let e=document.querySelectorAll("[data-component=selectquestion]");for(let t of e)try{if(0==$(t).closest("[data-component=timedAssessment]").length){let e=new a({orig:t});await e.initialize()}}catch(e){console.log(`Error rendering New Exercise ${t.id}\n                         Details: ${e}`),console.log(e.stack)}}))}}]);
//# sourceMappingURL=448.bundle.js.map?v=86ff502c9c78ec460af7